---
import dayjs from "dayjs";
import WritingListItem from "./WritingListItem.astro";

// dayjs locale id
import "dayjs/locale/id";
dayjs.locale("id");

// dayjs timezone
import timezone from "dayjs/plugin/timezone";
dayjs.extend(timezone);
dayjs.tz.setDefault("Asia/Jakarta");

let blogs = await Astro.glob("../../pages/blog/*.mdx");

blogs.forEach((blogPost) => {
  blogPost.frontmatter.publishDate = dayjs(blogPost.frontmatter.publishDate).format("YYYY-MM-DDTHH:mm:ss.000Z");
});

blogs = blogs.sort((a, b) => {
  return dayjs(b.frontmatter.publishDate).unix() - dayjs(a.frontmatter.publishDate).unix();
});

const posts = blogs.map((blogPost) => {
  return {
    title: blogPost.frontmatter.title,
    coverImage:
      "https://images.unsplash.com/photo-1606206873764-fd15e242df52?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2670&q=80",
    publishedAt: blogPost.frontmatter.publishDate,
    link: blogPost.url,
    tags: blogPost.frontmatter.tags,
  };
});

const articles = posts.slice(0, 4);
---

<ul
  id="writing-list"
  class="mx-auto grid max-w-[1244px] grid-cols-1 place-content-center gap-x-5 gap-y-3 pt-24 sm:grid-cols-2 sm:gap-y-6 lg:grid-cols-[repeat(2,480px)] xl:grid-cols-[repeat(2,545px)]"
>
  {
    articles?.map(
      (article: {
        title: string;
        coverImage: string;
        slug?: string;
        domain?: string;
        link?: string;
        tags?: string[];
      }) => (
        <WritingListItem
          hostname={article.domain as string}
          slug={article.slug}
          link={article.link}
          title={article.title}
          coverImage={article.coverImage}
          tags={article.tags}
        />
      )
    )
  }
</ul>
